<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nix 2.1 Studio</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        body { font-family: 'Inter', sans-serif; transition: background-color 0.3s ease; }
        
        .dark { background-color: #050505; color: #EDEDED; }
        .light { background-color: #F9F9F9; color: #1A1A1A; }

        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .dark .custom-scrollbar::-webkit-scrollbar-thumb { background: #27272a; border-radius: 10px; }
        .light .custom-scrollbar::-webkit-scrollbar-thumb { background: #d4d4d8; border-radius: 10px; }

        .dot-grid-dark { background-image: radial-gradient(#1a1a1a 1px, transparent 1px); background-size: 32px 32px; }
        .dot-grid-light { background-image: radial-gradient(#e5e7eb 1px, transparent 1px); background-size: 32px 32px; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        
        pre { background: #111; padding: 1rem; border-radius: 0.75rem; overflow-x: auto; margin: 1rem 0; border: 1px solid #333; }
        code { font-family: 'Fira Code', monospace; font-size: 0.85rem; }
    </style>
</head>
<body class="dark overflow-hidden h-screen">
    <div class="flex h-full w-full">
        
        <!-- Sidebar -->
        <aside class="w-72 border-r hidden md:flex flex-col bg-black border-zinc-800 transition-colors duration-300" id="sidebar">
            <div class="p-6 border-b border-zinc-800 flex items-center gap-3">
                <div class="w-8 h-8 bg-indigo-600 rounded-lg flex items-center justify-center font-bold text-white shadow-[0_0_15px_rgba(79,70,229,0.4)]">N</div>
                <span class="font-bold tracking-tight text-lg text-white">Nix 2 Studio</span>
            </div>
            
            <div class="flex-1 p-4 overflow-y-auto space-y-2 custom-scrollbar">
                <button onclick="clearChat()" class="w-full text-left p-3 rounded-xl border border-zinc-800 bg-zinc-900 text-zinc-300 hover:bg-zinc-800 transition-all flex items-center gap-3 group">
                    <i data-lucide="plus" class="w-4 h-4 text-indigo-500 group-hover:scale-125 transition-transform"></i>
                    New Session
                </button>
            </div>

            <div class="p-4 border-t border-zinc-800 bg-zinc-950/50">
                <div class="flex items-center gap-3 p-2 rounded-xl transition-colors cursor-pointer hover:bg-zinc-900">
                    <div id="user-avatar" class="w-8 h-8 rounded-full bg-indigo-500 flex items-center justify-center text-white text-[10px] font-bold">N</div>
                    <div class="flex-1 overflow-hidden">
                        <div id="user-display-name" class="text-xs font-bold truncate text-white">Nix 2.1</div>
                        <div id="user-status" class="text-[10px] text-zinc-500">by CodeNix</div>
                    </div>
                    <button onclick="toggleTheme()" class="p-1.5 hover:bg-zinc-800 rounded-md transition-colors theme-btn-sidebar">
                        <i data-lucide="sun" class="w-4 h-4 text-zinc-400"></i>
                    </button>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 flex flex-col relative dot-grid-dark" id="main-content">
            <!-- Header -->
            <header class="h-14 border-b border-zinc-800 flex items-center justify-between px-6 backdrop-blur-xl z-30 bg-black/80 transition-colors duration-300" id="header">
                <div class="flex items-center gap-3">
                    <span class="text-[10px] font-bold text-zinc-500 uppercase tracking-widest">Active Model</span>
                    <span class="h-1.5 w-1.5 rounded-full bg-indigo-500 shadow-[0_0_8px_rgba(99,102,241,0.8)] animate-pulse"></span>
                    <span class="text-sm font-bold tracking-tight text-white" id="model-tag">Nix-2.1-Flash</span>
                </div>
                <div class="flex items-center gap-4">
                    <button onclick="toggleTheme()" class="p-2 text-zinc-500 hover:text-indigo-500 transition-colors md:hidden">
                        <i data-lucide="sun" class="w-5 h-5 theme-icon-mobile"></i>
                    </button>
                    <button id="reset-btn" onclick="clearChat()" class="text-[10px] uppercase font-bold tracking-wider border border-zinc-800 text-zinc-500 px-3 py-1.5 rounded-md hover:text-white transition-colors">Reset</button>
                </div>
            </header>

            <!-- Chat Area -->
            <div id="chat-container" class="flex-1 overflow-y-auto custom-scrollbar p-6">
                <div class="max-w-3xl mx-auto py-12" id="messages-list">
                    <div id="welcome-screen" class="py-20 text-center animate-fade-in">
                        <div class="w-16 h-16 border border-zinc-800 bg-zinc-900 rounded-3xl flex items-center justify-center mx-auto mb-8 shadow-2xl">
                            <i data-lucide="terminal" class="w-8 h-8 text-indigo-500"></i>
                        </div>
                        <h1 class="text-4xl font-bold mb-4 tracking-tight text-white welcome-title">Nix 2.1</h1>
                        <p class="text-zinc-500 text-sm max-w-sm mx-auto leading-relaxed">
                            Developed by CodeNix. Powered by the LongCat API Platform.
                        </p>
                    </div>
                </div>
            </div>

            <!-- Input Area -->
            <div class="p-6 relative z-40">
                <div class="max-w-3xl mx-auto relative">
                    <div class="border border-zinc-800 bg-[#0c0c0c] rounded-[2.5rem] shadow-2xl overflow-hidden transition-all focus-within:ring-4 focus-within:ring-indigo-500/10 focus-within:border-indigo-500/50" id="input-container">
                        <form id="chat-form">
                            <textarea 
                                id="user-input"
                                placeholder="Message Nix 2..."
                                class="w-full bg-transparent px-8 py-6 text-sm focus:outline-none resize-none min-h-[70px] max-h-[200px] text-white placeholder:text-zinc-600"
                                rows="1"
                            ></textarea>
                            <div class="flex items-center justify-between px-6 py-4 border-t border-white/5 bg-black/40">
                                <div class="flex items-center gap-4">
                                    <span class="text-[10px] text-zinc-500 font-mono hidden sm:block">CodeNix Nix-2 Series</span>
                                </div>
                                <button type="submit" id="send-btn" class="bg-indigo-600 text-white px-8 py-2.5 rounded-full text-xs font-bold hover:bg-indigo-500 transition-all shadow-[0_4px_15px_rgba(79,70,229,0.3)] flex items-center gap-2 group">
                                    Send
                                    <i data-lucide="send" class="w-3 h-3 group-hover:translate-x-0.5 transition-transform"></i>
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Longcat Configuration
        const API_KEY = "ak_2Q14Wb6iZ0DI72b1Im4pv1jo3iO9X";
        const API_URL = "https://api.longcat.chat/openai/v1/chat/completions";
        const MODEL_NAME = "LongCat-Flash-Chat";

        // Nix 2 Personality System Instruction
        const SYSTEM_PROMPT = {
            role: "system",
            content: "You are Nix 2, a highly advanced AI assistant developed by CodeNix. You are helpful, precise, and maintain a professional yet approachable tone. Always identify as Nix 2 by CodeNix if asked about your identity."
        };

        let theme = 'dark';
        let chatHistory = [];

        // UI Initialization
        lucide.createIcons();

        const userInput = document.getElementById('user-input');
        const chatForm = document.getElementById('chat-form');
        const messagesList = document.getElementById('messages-list');

        userInput.addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = (this.scrollHeight) + 'px';
        });

        userInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                chatForm.dispatchEvent(new Event('submit'));
            }
        });

        function toggleTheme() {
            theme = theme === 'dark' ? 'light' : 'dark';
            document.body.className = theme + " overflow-hidden h-screen";
            
            const mainContent = document.getElementById('main-content');
            const sidebar = document.getElementById('sidebar');
            const header = document.getElementById('header');
            const inputContainer = document.getElementById('input-container');

            if (theme === 'light') {
                mainContent.classList.replace('dot-grid-dark', 'dot-grid-light');
                sidebar.className = "w-72 border-r hidden md:flex flex-col bg-white border-zinc-200 transition-colors duration-300";
                header.className = "h-14 border-b border-zinc-200 flex items-center justify-between px-6 backdrop-blur-xl z-30 bg-white/80 transition-colors duration-300";
                inputContainer.className = "border border-zinc-200 bg-white rounded-[2.5rem] shadow-2xl overflow-hidden transition-all focus-within:ring-4 focus-within:ring-indigo-500/10 focus-within:border-indigo-500";
                userInput.className = "w-full bg-transparent px-8 py-6 text-sm focus:outline-none resize-none min-h-[70px] max-h-[200px] text-zinc-900 placeholder:text-zinc-400";
                document.querySelectorAll('.welcome-title, #model-tag, #user-display-name').forEach(el => el.classList.replace('text-white', 'text-zinc-900'));
            } else {
                mainContent.classList.replace('dot-grid-light', 'dot-grid-dark');
                sidebar.className = "w-72 border-r hidden md:flex flex-col bg-black border-zinc-800 transition-colors duration-300";
                header.className = "h-14 border-b border-zinc-800 flex items-center justify-between px-6 backdrop-blur-xl z-30 bg-black/80 transition-colors duration-300";
                inputContainer.className = "border border-zinc-800 bg-[#0c0c0c] rounded-[2.5rem] shadow-2xl overflow-hidden transition-all focus-within:ring-4 focus-within:ring-indigo-500/10 focus-within:border-indigo-500/50";
                userInput.className = "w-full bg-transparent px-8 py-6 text-sm focus:outline-none resize-none min-h-[70px] max-h-[200px] text-white placeholder:text-zinc-600";
                document.querySelectorAll('.welcome-title, #model-tag, #user-display-name').forEach(el => el.classList.replace('text-zinc-900', 'text-white'));
            }
            lucide.createIcons();
        }

        chatForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const text = userInput.value.trim();
            if (!text) return;

            if (document.getElementById('welcome-screen')) document.getElementById('welcome-screen').remove();

            appendMessage('user', text);
            chatHistory.push({ role: "user", content: text });
            
            userInput.value = '';
            userInput.style.height = 'auto';

            await handleLongcatAPI();
        });

        async function handleLongcatAPI() {
            const botMsgId = appendMessage('bot', '', true);
            
            try {
                // Ensure system prompt is always present as the first message
                const messagesToSend = [SYSTEM_PROMPT, ...chatHistory];

                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${API_KEY}`
                    },
                    body: JSON.stringify({ 
                        model: MODEL_NAME,
                        messages: messagesToSend,
                        temperature: 0.7,
                        max_tokens: 4096,
                        stream: false
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error?.message || `API Error: ${response.status}`);
                }

                const data = await response.json();
                const botContent = data.choices[0].message.content;
                
                chatHistory.push({ role: "assistant", content: botContent });
                updateBotMessage(botMsgId, botContent);

            } catch (err) {
                updateBotMessage(botMsgId, "Nix Connection Error: " + err.message, true);
            }
        }

        function appendMessage(role, content, isThinking = false) {
            const id = 'msg-' + Date.now();
            const div = document.createElement('div');
            const themeClass = theme === 'dark' ? 'text-zinc-300' : 'text-zinc-700';
            const bgClass = role === 'user' ? (theme === 'dark' ? 'bg-zinc-900/30 border border-white/5' : 'bg-zinc-100 border border-zinc-200') : '';
            
            div.id = id;
            div.className = `flex gap-6 p-8 rounded-[2rem] mb-6 animate-fade-in ${bgClass}`;
            
            const avatarColor = role === 'user' ? 'bg-zinc-500' : 'bg-indigo-600';
            const avatarName = role === 'user' ? 'You' : 'Nix';

            div.innerHTML = `
                <div class="w-10 h-10 rounded-2xl shrink-0 flex items-center justify-center font-bold text-[10px] uppercase text-white ${avatarColor}">
                    ${avatarName}
                </div>
                <div class="flex-1 min-w-0">
                    <div class="message-body text-[15px] leading-relaxed whitespace-pre-wrap ${themeClass}">
                        ${isThinking ? '<div class="flex gap-1.5 py-2"><div class="w-1.5 h-1.5 bg-indigo-500 rounded-full animate-bounce"></div><div class="w-1.5 h-1.5 bg-indigo-500 rounded-full animate-bounce [animation-delay:0.2s]"></div><div class="w-1.5 h-1.5 bg-indigo-500 rounded-full animate-bounce [animation-delay:0.4s]"></div></div>' : formatContent(content)}
                    </div>
                </div>
            `;
            
            messagesList.appendChild(div);
            scrollChat();
            return id;
        }

        function updateBotMessage(id, content, isError = false) {
            const container = document.getElementById(id);
            if (!container) return;
            const body = container.querySelector('.message-body');
            
            if (isError) {
                body.className = "message-body text-[15px] text-red-400 font-medium";
                body.innerHTML = content;
            } else {
                body.innerHTML = formatContent(content);
            }
            
            lucide.createIcons();
            scrollChat();
        }

        function formatContent(text) {
            let formatted = text
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/```(\w*)\n([\s\S]*?)```/g, '<pre><code>$2</code></pre>')
                .replace(/`([^`]+)`/g, '<code class="bg-zinc-800 px-1 rounded">$1</code>')
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            
            return formatted;
        }

        function scrollChat() {
            const container = document.getElementById('chat-container');
            container.scrollTo({ top: container.scrollHeight, behavior: 'smooth' });
        }

        function clearChat() {
            chatHistory = [];
            messagesList.innerHTML = `
                <div id="welcome-screen" class="py-20 text-center animate-fade-in">
                    <div class="w-16 h-16 border border-zinc-800 bg-zinc-900 rounded-3xl flex items-center justify-center mx-auto mb-8 shadow-2xl">
                        <i data-lucide="terminal" class="w-8 h-8 text-indigo-500"></i>
                    </div>
                    <h1 class="text-4xl font-bold mb-4 tracking-tight text-white welcome-title">Nix 2.1</h1>
                    <p class="text-zinc-500 text-sm max-w-sm mx-auto leading-relaxed">
                        Developed by CodeNix. Powered by the LongCat API Platform.
                    </p>
                </div>
            `;
            lucide.createIcons();
        }
    </script>
</body>
</html>
