<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qurany - إذاعات القرآن الكريم</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Cairo', sans-serif;
            scroll-behavior: smooth;
        }
        .gradient-bg {
            background: radial-gradient(circle at top right, #1e3a8a, #0f172a);
            min-height: 100vh;
        }
        .glass-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .station-item:hover {
            transform: translateY(-4px);
            background: rgba(255, 255, 255, 0.15);
        }
        .active-station {
            background: #ffffff !important;
            color: #1e3a8a !important;
            font-weight: 700;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3);
        }
        /* Volume Range Styling */
        input[type=range] {
            -webkit-appearance: none;
            background: transparent;
        }
        input[type=range]::-webkit-slider-runnable-track {
            height: 6px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 18px;
            width: 18px;
            border-radius: 50%;
            background: #ffffff;
            cursor: pointer;
            margin-top: -6px;
        }
        .custom-select {
            background-color: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: white;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='white'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: left 0.75rem center;
            background-size: 1rem;
        }
        .custom-select option {
            background-color: #0f172a;
            color: white;
        }
    </style>
</head>
<body class="gradient-bg text-white pb-12">

    <div class="container mx-auto p-4 md:p-8 max-w-6xl">

        <!-- Top Navigation -->
        <nav class="flex justify-between items-center mb-10">
            <a href="portal.html" class="flex items-center gap-2 bg-white/10 hover:bg-white/20 transition-colors px-4 py-2 rounded-full text-sm">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>
                العودة للبوابة
            </a>
            <div class="text-2xl font-bold tracking-wider">QURANY</div>
        </nav>

        <!-- Header -->
        <header class="text-center mb-12">
            <h1 class="text-4xl md:text-6xl font-bold mb-4">إذاعات القرآن الكريم</h1>
            <p class="text-blue-200 opacity-80 max-w-xl mx-auto">بث مباشر لأشهر الإذاعات الإسلامية وتلاوات عطرة بأصوات كبار القراء من جميع أنحاء العالم.</p>
        </header>

        <!-- Main Player Sticky Section -->
        <div class="sticky top-4 z-50 mb-12">
            <main id="player" class="glass-card rounded-3xl p-6 md:p-8 shadow-2xl border-white/20">
                <div class="flex flex-col md:flex-row items-center gap-8">
                    <!-- Play Button -->
                    <button id="playPauseBtn" class="w-24 h-24 rounded-full bg-white text-blue-900 flex items-center justify-center shadow-2xl hover:scale-105 transition-all active:scale-95 flex-shrink-0 group">
                        <svg id="playIcon" class="w-12 h-12" viewBox="0 0 24 24" fill="currentColor"><path d="M8 5v14l11-7z"></path></svg>
                        <svg id="pauseIcon" class="w-12 h-12 hidden" viewBox="0 0 24 24" fill="currentColor"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"></path></svg>
                    </button>

                    <div class="flex-grow w-full">
                        <div class="flex flex-col md:flex-row md:items-end justify-between gap-4">
                            <div class="text-center md:text-right">
                                <span class="text-blue-300 text-xs font-semibold uppercase tracking-widest mb-1 block">تستمع الآن إلى</span>
                                <h2 id="stationName" class="text-2xl md:text-3xl font-bold line-clamp-1">اختر إذاعة للبدء</h2>
                            </div>
                            
                            <div class="flex flex-col gap-2 min-w-[200px]">
                                <div class="flex items-center gap-3">
                                    <svg class="w-5 h-5 text-white/50" fill="currentColor" viewBox="0 0 24 24"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02z"></path></svg>
                                    <input id="volumeSlider" type="range" min="0" max="1" step="0.01" value="0.8" class="w-full">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <audio id="audioPlayer" preload="none"></audio>
            </main>
        </div>

        <!-- Two Column Layout for Selectors and List -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <!-- Side Controls: Reciters -->
            <aside class="lg:col-span-1 space-y-6">
                <section class="glass-card rounded-3xl p-6">
                    <h3 class="text-xl font-bold mb-6 flex items-center gap-2">
                        <svg class="w-5 h-5 text-blue-400" fill="currentColor" viewBox="0 0 24 24"><path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"></path></svg>
                        تلاوات خاصة
                    </h3>
                    <div class="space-y-4">
                        <div>
                            <label class="text-xs text-white/50 mb-2 block">القارئ</label>
                            <select id="reciterSelect" class="custom-select w-full p-4 rounded-xl focus:ring-2 ring-blue-500 outline-none transition-all">
                                <option selected disabled>جاري التحميل...</option>
                            </select>
                        </div>
                        <div>
                            <label class="text-xs text-white/50 mb-2 block">السورة</label>
                            <select id="surahSelect" class="custom-select w-full p-4 rounded-xl focus:ring-2 ring-blue-500 outline-none transition-all" disabled>
                                <option selected disabled>اختر القارئ أولاً</option>
                            </select>
                        </div>
                    </div>
                </section>
                
                <section class="glass-card rounded-3xl p-6 hidden lg:block">
                    <h4 class="font-bold mb-2">عن تطبيق قرآني</h4>
                    <p class="text-sm text-white/60 leading-relaxed">
                        استمتع بتجربة إيمانية فريدة مع وصول سريع لمئات المحطات الإذاعية القرآنية الموثوقة.
                    </p>
                </section>
            </aside>

            <!-- Main Content: Stations -->
            <section class="lg:col-span-2">
                <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-6">
                    <h3 class="text-2xl font-bold">قائمة المحطات</h3>
                    <div class="relative w-full md:w-64">
                        <input id="searchInput" type="text" placeholder="بحث عن إذاعة..." class="w-full bg-white/5 border border-white/10 rounded-full py-2 px-10 focus:ring-2 ring-blue-500 outline-none text-sm">
                        <svg class="w-4 h-4 absolute right-4 top-1/2 -translate-y-1/2 text-white/30" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                    </div>
                </div>

                <!-- Loading Spinner -->
                <div id="loading" class="text-center py-20">
                    <div class="inline-block animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-white mb-4"></div>
                    <p class="text-white/40">يرجى الانتظار، جاري جلب البيانات...</p>
                </div>

                <div id="stationsGrid" class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <!-- Stations injected here -->
                </div>
            </section>
        </div>

        <!-- Footer -->
        <footer class="text-center mt-20 text-white/30 text-sm">
            <div class="flex justify-center gap-6 mb-4 opacity-50">
                <span>تواصل معنا</span>
                <span>سياسة الخصوصية</span>
                <span>عن المشروع</span>
            </div>
            <p>&copy; 2024 جميع الحقوق محفوظة لـ Qurany</p>
        </footer>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const audioPlayer = document.getElementById('audioPlayer');
            const playPauseBtn = document.getElementById('playPauseBtn');
            const playIcon = document.getElementById('playIcon');
            const pauseIcon = document.getElementById('pauseIcon');
            const volumeSlider = document.getElementById('volumeSlider');
            const stationNameDisplay = document.getElementById('stationName');
            const stationsGrid = document.getElementById('stationsGrid');
            const loadingIndicator = document.getElementById('loading');
            const reciterSelect = document.getElementById('reciterSelect');
            const surahSelect = document.getElementById('surahSelect');
            const searchInput = document.getElementById('searchInput');

            let isPlaying = false;
            let currentActiveEl = null;
            let allStations = [];
            let allReciters = [];
            let allSurahs = [];

            // Initial static station
            const staticStations = [
                {
                    name: "إذاعة القرآن الكريم من القاهرة",
                    url: "https://n11.radiojar.com/8s5u5tpdtwzuv?rj-ttl=5"
                }
            ];

            function togglePlayPause() {
                if (!audioPlayer.src) return;
                if (audioPlayer.paused) {
                    audioPlayer.play().catch(e => console.error(e));
                } else {
                    audioPlayer.pause();
                }
            }

            function updateUIState() {
                isPlaying = !audioPlayer.paused;
                playIcon.classList.toggle('hidden', isPlaying);
                pauseIcon.classList.toggle('hidden', !isPlaying);
            }

            function playSource(name, url, el = null) {
                stationNameDisplay.textContent = name;
                audioPlayer.src = url;
                audioPlayer.play();

                if (currentActiveEl) currentActiveEl.classList.remove('active-station');
                if (el) {
                    el.classList.add('active-station');
                    currentActiveEl = el;
                } else {
                    currentActiveEl = null;
                }
            }

            function renderStations(list) {
                stationsGrid.innerHTML = '';
                list.forEach(station => {
                    const div = document.createElement('div');
                    div.className = 'station-item glass-card rounded-2xl p-5 cursor-pointer transition-all flex justify-between items-center group';
                    div.innerHTML = `
                        <div class="font-semibold text-lg line-clamp-1">${station.name}</div>
                        <div class="opacity-0 group-hover:opacity-100 transition-opacity">
                            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"></path></svg>
                        </div>
                    `;
                    div.onclick = () => playSource(station.name, station.url, div);
                    stationsGrid.appendChild(div);
                });
            }

            searchInput.oninput = (e) => {
                const term = e.target.value.toLowerCase();
                const filtered = allStations.filter(s => s.name.toLowerCase().includes(term));
                renderStations(filtered);
            };

            // Audio Events
            playPauseBtn.onclick = togglePlayPause;
            audioPlayer.onplay = updateUIState;
            audioPlayer.onpause = updateUIState;
            volumeSlider.oninput = (e) => audioPlayer.volume = e.target.value;

            // Fetch Data
            async function init() {
                try {
                    const [radioRes, recitersRes, suwarRes] = await Promise.all([
                        fetch('https://www.mp3quran.net/api/v3/radios'),
                        fetch('https://www.mp3quran.net/api/v3/reciters?language=ar'),
                        fetch('https://www.mp3quran.net/api/v3/suwar?language=ar')
                    ]);

                    const radioData = await radioRes.json();
                    const reciterData = await recitersRes.json();
                    const suwarData = await suwarRes.json();

                    // Radios
                    allStations = [...staticStations, ...radioData.radios.map(r => ({name: r.name, url: r.url}))];
                    loadingIndicator.classList.add('hidden');
                    renderStations(allStations);

                    // Reciters
                    allReciters = reciterData.reciters;
                    allSurahs = suwarData.suwar;
                    
                    reciterSelect.innerHTML = '<option selected disabled>اختر القارئ...</option>';
                    allReciters.forEach(r => {
                        const moshaf = r.moshaf.find(m => m.name.includes("حفص")) || r.moshaf[0];
                        const opt = document.createElement('option');
                        opt.value = r.id;
                        opt.textContent = r.name;
                        opt.dataset.server = moshaf.server;
                        opt.dataset.surahs = moshaf.surah_list;
                        reciterSelect.appendChild(opt);
                    });

                } catch (err) {
                    console.error("API Error", err);
                    loadingIndicator.innerHTML = '<p class="text-red-400">فشل تحميل بعض البيانات</p>';
                }
            }

            reciterSelect.onchange = (e) => {
                const opt = e.target.options[e.target.selectedIndex];
                const availableIds = opt.dataset.surahs.split(',');
                
                surahSelect.innerHTML = '<option selected disabled>اختر السورة...</option>';
                availableIds.forEach(id => {
                    const s = allSurahs.find(item => item.id == id);
                    if(s) {
                        const sOpt = document.createElement('option');
                        sOpt.value = id;
                        sOpt.textContent = s.name;
                        surahSelect.appendChild(sOpt);
                    }
                });
                surahSelect.disabled = false;
            };

            surahSelect.onchange = (e) => {
                const rOpt = reciterSelect.options[reciterSelect.selectedIndex];
                const sOpt = e.target.options[e.target.selectedIndex];
                const server = rOpt.dataset.server;
                const fileId = String(e.target.value).padStart(3, '0');
                const url = `${server}/${fileId}.mp3`;
                playSource(`${sOpt.textContent} - ${rOpt.textContent}`, url);
            };

            init();
        });
    </script>
</body>
</html>
