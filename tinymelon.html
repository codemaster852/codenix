<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tiny Melon | Neural Image Gen</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&family=JetBrains+Mono:wght@400;500&display=swap');
        
        :root {
            --melon-primary: #4ade80;
            --melon-dark: #0f172a;
            --melon-surface: #1e293b;
        }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: var(--melon-dark);
            color: #f8fafc;
            overflow-x: hidden;
        }

        .melon-gradient-text {
            background: linear-gradient(135deg, #4ade80 0%, #22c55e 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .melon-btn {
            background: linear-gradient(135deg, #4ade80 0%, #22c55e 100%);
            box-shadow: 0 10px 15px -3px rgba(34, 197, 94, 0.3);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .melon-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 20px 25px -5px rgba(34, 197, 94, 0.4);
        }

        .glass-card {
            background: rgba(30, 41, 59, 0.5);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .log-mono {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.75rem;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }
        
        .shimmer {
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.05), transparent);
            background-size: 200% 100%;
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }

        @keyframes pulse-ring {
            0% { transform: scale(.33); opacity: 1; }
            80%, 100% { opacity: 0; }
        }
    </style>
</head>
<body class="min-h-screen flex flex-col md:flex-row overflow-hidden">

    <!-- Sidebar / History -->
    <aside class="w-full md:w-72 glass-card border-r border-slate-800 p-6 flex flex-col hidden md:flex">
        <div class="flex items-center gap-3 mb-10">
            <div class="w-8 h-8 rounded-lg bg-green-500 flex items-center justify-center">
                <i class="fas fa-brain text-white text-xs"></i>
            </div>
            <h2 class="text-sm font-800 uppercase tracking-widest text-slate-400">Recent Tasks</h2>
        </div>
        
        <div id="historyList" class="flex-1 overflow-y-auto space-y-4 pr-2">
            <!-- History items will be injected here -->
            <div class="text-xs text-slate-500 italic">No recent generations</div>
        </div>

        <div class="mt-auto pt-6 border-t border-slate-800">
            <div class="flex items-center gap-3 text-xs text-slate-400">
                <div class="w-2 h-2 rounded-full bg-green-500"></div>
                Tiny Melon Model v2.5 Stable
            </div>
        </div>
    </aside>

    <!-- Main Workspace -->
    <main class="flex-1 relative flex flex-col h-screen">
        
        <!-- Top Nav -->
        <nav class="p-6 flex justify-between items-center bg-slate-950/20 backdrop-blur-sm z-10">
            <div class="flex items-center gap-3">
                <h1 class="text-xl font-800 tracking-tight">Tiny <span class="melon-gradient-text">Melon</span></h1>
                <span class="text-[10px] bg-green-500/10 text-green-400 border border-green-500/20 px-2 py-0.5 rounded-full font-bold uppercase tracking-tighter">Pro</span>
            </div>
            <div class="flex gap-4">
                <div class="hidden sm:flex items-center gap-2 bg-slate-900 px-4 py-2 rounded-xl border border-slate-800">
                    <span class="text-[10px] text-slate-500 font-bold uppercase">Uptime</span>
                    <span class="text-xs font-mono text-green-400" id="uptimeCounter">99.98%</span>
                </div>
            </div>
        </nav>

        <!-- Editor Area -->
        <section class="flex-1 overflow-y-auto p-4 md:p-10 flex flex-col items-center">
            <div class="w-full max-w-3xl space-y-8">
                
                <!-- Input Module -->
                <div class="glass-card rounded-3xl p-1 shadow-2xl">
                    <div class="relative">
                        <textarea id="promptInput" 
                            class="w-full bg-slate-900/40 border-0 rounded-[22px] p-6 pr-40 text-lg focus:ring-2 focus:ring-green-500/30 transition-all resize-none h-40 outline-none placeholder:text-slate-600"
                            placeholder="A futuristic melon floating in a neon synthwave nebula..."></textarea>
                        
                        <div class="absolute bottom-6 right-6 flex items-center gap-4">
                            <button id="generateBtn" 
                                class="melon-btn text-slate-950 font-800 px-8 py-4 rounded-2xl flex items-center gap-3 active:scale-95">
                                <span id="btnText">Imagine</span>
                                <i class="fas fa-sparkles text-sm"></i>
                                <div id="btnLoader" class="hidden w-5 h-5 border-2 border-slate-900 border-t-transparent rounded-full animate-spin"></div>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Status Console -->
                <div id="logSection" class="hidden glass-card rounded-2xl p-4 overflow-hidden border border-slate-800/50">
                    <div class="flex items-center justify-between mb-3 border-b border-slate-800 pb-2">
                        <span class="text-[10px] font-bold text-slate-500 uppercase flex items-center gap-2">
                            <span class="w-1.5 h-1.5 rounded-full bg-green-500 animate-pulse"></span>
                            Neural Link Active
                        </span>
                        <span id="current-engine" class="text-[10px] font-mono text-slate-400 italic">Idle</span>
                    </div>
                    <div id="logContent" class="log-mono space-y-1"></div>
                </div>

                <!-- Visual Output -->
                <div id="resultContainer" class="hidden group relative">
                    <div class="absolute -inset-1 bg-gradient-to-r from-green-500 to-emerald-600 rounded-[30px] blur opacity-25 group-hover:opacity-50 transition duration-1000"></div>
                    <div class="relative glass-card rounded-[28px] overflow-hidden">
                        <img id="resultImage" src="" alt="Neural Output" class="w-full h-auto object-cover min-h-[400px]">
                        <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-all duration-500 p-8 flex justify-between items-end">
                            <div class="text-white">
                                <p class="text-xs font-bold uppercase tracking-widest text-green-400 mb-1">Generated by Tiny Melon</p>
                                <p id="finalPrompt" class="text-sm text-slate-300 line-clamp-1 italic"></p>
                            </div>
                            <button onclick="downloadImage()" class="w-12 h-12 bg-white/10 hover:bg-white/20 backdrop-blur-xl rounded-full flex items-center justify-center transition-all border border-white/10">
                                <i class="fas fa-arrow-down"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Empty State -->
                <div id="placeholder" class="py-20 flex flex-col items-center justify-center text-slate-600 space-y-4">
                    <div class="w-16 h-16 rounded-3xl border-2 border-dashed border-slate-800 flex items-center justify-center text-2xl">
                        <i class="fas fa-image opacity-20"></i>
                    </div>
                    <p class="text-sm font-medium">Ready for your creative prompt</p>
                </div>

            </div>
        </section>
    </main>

    <script>
        // API Configuration
        const STABILITY_KEY = "sk-46PR2cohKeslNX6jsJZ9VRU8gWDN7rwTmTaa5HDPAhPxYNbn";
        const GROK_KEY = "xai-LQqtydVnyXjrh51kYS4zXkhB2lpAkPyZ3eQcf7gGrt3TNHVtqfkNmnkXgkqjq96vubZat1GPlgkf7Enq";
        
        const generateBtn = document.getElementById('generateBtn');
        const promptInput = document.getElementById('promptInput');
        const logContent = document.getElementById('logContent');
        const logSection = document.getElementById('logSection');
        const resultImage = document.getElementById('resultImage');
        const resultContainer = document.getElementById('resultContainer');
        const placeholder = document.getElementById('placeholder');
        const engineTag = document.getElementById('current-engine');
        const historyList = document.getElementById('historyList');

        function addLog(message, type = 'info') {
            const colors = {
                info: 'text-slate-400',
                success: 'text-green-400 font-bold',
                warning: 'text-yellow-500',
                error: 'text-rose-500'
            };
            const log = document.createElement('div');
            log.className = `${colors[type]} leading-tight`;
            log.innerHTML = `<span class="opacity-30">>></span> ${message}`;
            logContent.appendChild(log);
            logSection.classList.remove('hidden');
            logSection.scrollTop = logSection.scrollHeight;
        }

        function addToHistory(prompt, src) {
            if(historyList.querySelector('.italic')) historyList.innerHTML = '';
            const item = document.createElement('div');
            item.className = "group relative aspect-square w-full rounded-xl overflow-hidden glass-card cursor-pointer border border-slate-800 hover:border-green-500/50 transition-all";
            item.innerHTML = `
                <img src="${src}" class="w-full h-full object-cover opacity-60 group-hover:opacity-100 transition-opacity">
                <div class="absolute inset-0 bg-black/60 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity">
                    <i class="fas fa-eye text-white"></i>
                </div>
            `;
            item.onclick = () => {
                resultImage.src = src;
                document.getElementById('finalPrompt').innerText = prompt;
                resultContainer.classList.remove('hidden');
                placeholder.classList.add('hidden');
            };
            historyList.prepend(item);
        }

        async function tryStability(prompt) {
            addLog("Tiny Melon Model: Initializing Core...", "info");
            engineTag.innerText = "Tiny Melon (SDXL)";
            
            const response = await fetch("https://api.stability.ai/v1/generation/stable-diffusion-xl-1024-v1-0/text-to-image", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "Accept": "application/json",
                    "Authorization": `Bearer ${STABILITY_KEY}`,
                },
                body: JSON.stringify({
                    text_prompts: [{ text: prompt }],
                    cfg_scale: 7,
                    height: 1024,
                    width: 1024,
                    samples: 1,
                    steps: 30,
                }),
            });

            if (!response.ok) throw new Error(`Latency Peak: ${response.status}`);
            const data = await response.json();
            return `data:image/png;base64,${data.artifacts[0].base64}`;
        }

        async function tryGrok(prompt) {
            addLog("Scaling to Secondary Neural Cluster...", "warning");
            engineTag.innerText = "Tiny Melon (Grok-2)";
            
            const response = await fetch("https://api.x.ai/v1/images/generations", {
                method: "POST",
                headers: {
                    "Authorization": `Bearer ${GROK_KEY}`,
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({
                    model: "grok-2-image",
                    prompt: prompt,
                    n: 1,
                    response_format: "b64_json"
                }),
            });

            if (!response.ok) throw new Error(`Cluster Timeout: ${response.status}`);
            const data = await response.json();
            return data.data[0].b64_json.startsWith('data:') 
                ? data.data[0].b64_json 
                : `data:image/jpeg;base64,${data.data[0].b64_json}`;
        }

        async function tryPublicSearch(prompt) {
            addLog("Critical failure. Accessing Public Visual Vault...", "warning");
            engineTag.innerText = "Vault Search";
            const searchUrl = `https://source.unsplash.com/featured/1024x1024/?${encodeURIComponent(prompt)}`;
            const check = await fetch(searchUrl);
            if (!check.ok) throw new Error("Vault empty");
            return searchUrl;
        }

        generateBtn.addEventListener('click', async () => {
            const prompt = promptInput.value.trim();
            if (!prompt) return;

            generateBtn.disabled = true;
            document.getElementById('btnText').innerText = "Analyzing...";
            document.getElementById('btnLoader').classList.remove('hidden');
            logContent.innerHTML = '';
            
            try {
                let imageUrl;
                
                try {
                    imageUrl = await tryStability(prompt);
                } catch (e) {
                    try {
                        imageUrl = await tryGrok(prompt);
                    } catch (e2) {
                        imageUrl = await tryPublicSearch(prompt);
                    }
                }

                resultImage.src = imageUrl;
                document.getElementById('finalPrompt').innerText = prompt;
                resultContainer.classList.remove('hidden');
                placeholder.classList.add('hidden');
                addLog("Quantum Image Synthesis Complete.", "success");
                addToHistory(prompt, imageUrl);

            } catch (err) {
                addLog(`SYSTEM FAILURE: ${err.message}`, "error");
                engineTag.innerText = "Fatal Error";
            } finally {
                generateBtn.disabled = false;
                document.getElementById('btnText').innerText = "Imagine";
                document.getElementById('btnLoader').classList.add('hidden');
            }
        });

        function downloadImage() {
            const link = document.createElement('a');
            link.href = resultImage.src;
            link.download = `tiny-melon-${Date.now()}.png`;
            link.click();
        }

        // Fake uptime drift
        setInterval(() => {
            const uptime = 99 + (Math.random() * 0.99);
            document.getElementById('uptimeCounter').innerText = uptime.toFixed(2) + "%";
        }, 5000);
    </script>
</body>
</html>
