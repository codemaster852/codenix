<!DOCTYPE html>
<html lang="en" class="dark" id="html-root">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GeoQuest Pro - Real World Exploration</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'], mono: ['JetBrains Mono', 'monospace'] },
                    colors: {
                        brand: { 500: '#6366f1', 600: '#4f46e5' },
                        surface: { light: '#FFFFFF', dark: '#0a0a0a' }
                    }
                }
            }
        }
    </script>

    <style>
        body { background-color: #FFFFFF; color: #111827; transition: background-color 0.2s; -webkit-font-smoothing: antialiased; }
        .dark body { background-color: #000000; color: #FFFFFF; }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(12px);
            border: 1px solid #E5E7EB;
        }
        .dark .glass-card {
            background: rgba(10, 10, 10, 0.8);
            border: 1px solid #1A1A1A;
        }

        #map {
            height: 65vh;
            width: 100%;
            border-radius: 1.5rem;
            z-index: 10;
        }

        /* Custom Map Styling to match Dark Mode */
        .dark .leaflet-container { background: #000 !important; }
        .dark .leaflet-tile-pane { filter: invert(100%) hue-rotate(180deg) brightness(95%) contrast(90%); }
        
        .bg-grid-pattern {
            background-size: 40px 40px;
            background-image: linear-gradient(to right, currentColor 1px, transparent 1px),
                              linear-gradient(to bottom, currentColor 1px, transparent 1px);
            mask-image: radial-gradient(circle at center, black 30%, transparent 90%);
            color: rgba(99, 102, 241, 0.05);
        }

        .custom-marker {
            width: 20px; height: 20px;
            background: #6366f1;
            border: 3px solid white;
            border-radius: 50%;
            box-shadow: 0 0 15px rgba(99, 102, 241, 0.5);
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            100% { transform: scale(2.5); opacity: 0; }
        }
    </style>
</head>
<body class="min-h-screen relative overflow-hidden">

    <div class="absolute inset-0 bg-grid-pattern pointer-events-none"></div>

    <!-- Nav -->
    <nav class="relative z-30 border-b border-gray-200 dark:border-zinc-800 bg-white/80 dark:bg-black/80 backdrop-blur-md">
        <div class="max-w-7xl mx-auto px-6 h-16 flex justify-between items-center">
            <div class="flex items-center gap-2">
                <div class="w-8 h-8 bg-brand-600 rounded-lg flex items-center justify-center text-white font-bold">G</div>
                <span class="font-bold tracking-tight text-xl">GeoQuest <span class="text-brand-600">Pro</span></span>
            </div>

            <div class="flex items-center gap-4">
                <div class="hidden md:flex flex-col items-end">
                    <span class="text-[10px] font-bold text-zinc-500 uppercase tracking-widest">Global Ranking</span>
                    <span class="text-xs font-mono text-brand-600">Level 1: Explorer</span>
                </div>
                <button onclick="toggleTheme()" class="p-2.5 rounded-xl border border-gray-200 dark:border-zinc-800 hover:bg-zinc-100 dark:hover:bg-zinc-900 transition-all">
                    <svg id="theme-icon" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path></svg>
                </button>
            </div>
        </div>
    </nav>

    <!-- UI Overlay -->
    <main class="relative z-20 max-w-7xl mx-auto p-6 flex flex-col gap-6">
        
        <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
            <!-- Game Control Side -->
            <div class="lg:col-span-1 space-y-6">
                <div class="glass-card p-6 rounded-3xl border-l-4 border-l-brand-600 shadow-xl">
                    <h2 class="text-xs font-bold text-brand-600 uppercase tracking-widest mb-4">Mission Target</h2>
                    <div id="target-name" class="text-3xl font-black mb-2 tracking-tighter">Initializing...</div>
                    <p class="text-sm text-zinc-500">Find this location on the map and click it.</p>
                </div>

                <div class="glass-card p-6 rounded-3xl grid grid-cols-2 gap-4">
                    <div>
                        <p class="text-[10px] font-bold text-zinc-400 uppercase">Score</p>
                        <p id="score" class="text-2xl font-mono font-bold text-brand-600">0</p>
                    </div>
                    <div>
                        <p class="text-[10px] font-bold text-zinc-400 uppercase">Accuracy</p>
                        <p id="accuracy" class="text-2xl font-mono font-bold">100%</p>
                    </div>
                </div>

                <button onclick="resetGame()" class="w-full py-4 bg-zinc-900 dark:bg-white text-white dark:text-black rounded-2xl font-bold hover:scale-[1.02] transition-transform shadow-lg">
                    Skip Mission
                </button>
            </div>

            <!-- Map View -->
            <div class="lg:col-span-3 relative group">
                <div id="map" class="shadow-2xl border border-gray-200 dark:border-zinc-800"></div>
                
                <!-- Feedback Toast -->
                <div id="toast" class="absolute top-6 left-1/2 -translate-x-1/2 z-[1000] px-6 py-3 rounded-full font-bold shadow-2xl transition-all opacity-0 translate-y-[-20px] pointer-events-none">
                    Feedback Message
                </div>
            </div>
        </div>
    </main>

    <script>
        let map, score = 0, attempts = 0, currentTarget = null;
        let markers = [];

        const locations = [
            { name: "Paris, France", lat: 48.8566, lng: 2.3522 },
            { name: "Tokyo, Japan", lat: 35.6762, lng: 139.6503 },
            { name: "Cairo, Egypt", lat: 30.0444, lng: 31.2357 },
            { name: "New York, USA", lat: 40.7128, lng: -74.0060 },
            { name: "Sydney, Australia", lat: -33.8688, lng: 151.2093 },
            { name: "Rio de Janeiro, Brazil", lat: -22.9068, lng: -43.1729 },
            { name: "London, UK", lat: 51.5074, lng: -0.1278 },
            { name: "Dubai, UAE", lat: 25.2048, lng: 55.2708 },
            { name: "Moscow, Russia", lat: 55.7558, lng: 37.6173 },
            { name: "Cape Town, South Africa", lat: -33.9249, lng: 18.4241 }
        ];

        function initMap() {
            map = L.map('map', {
                center: [20, 0],
                zoom: 2,
                zoomControl: false,
                attributionControl: false
            });

            L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
                maxZoom: 19
            }).addTo(map);

            map.on('click', onMapClick);
            nextMission();
        }

        function nextMission() {
            // Remove previous markers
            markers.forEach(m => map.removeLayer(m));
            markers = [];
            
            currentTarget = locations[Math.floor(Math.random() * locations.length)];
            document.getElementById('target-name').innerText = currentTarget.name;
        }

        function onMapClick(e) {
            const clickPt = e.latlng;
            const targetPt = L.latLng(currentTarget.lat, currentTarget.lng);
            const distance = clickPt.distanceTo(targetPt) / 1000; // km

            attempts++;
            
            // Define "Correct" as within 500km for city-level accuracy
            if (distance < 500) {
                score += 100;
                showToast("ðŸŽ¯ Perfect Hit!", "success");
                addResultMarker(targetPt, true);
                setTimeout(nextMission, 1500);
            } else {
                score = Math.max(0, score - 20);
                showToast(`Too far! (${Math.round(distance)}km away)`, "error");
                addResultMarker(clickPt, false);
            }

            updateStats();
        }

        function addResultMarker(latlng, correct) {
            const icon = L.divIcon({
                className: 'custom-div-icon',
                html: `<div class="custom-marker" style="background: ${correct ? '#10b981' : '#ef4444'}"></div>`,
                iconSize: [20, 20],
                iconAnchor: [10, 10]
            });
            const m = L.marker(latlng, { icon: icon }).addTo(map);
            markers.push(m);
        }

        function showToast(msg, type) {
            const toast = document.getElementById('toast');
            toast.innerText = msg;
            toast.className = `absolute top-6 left-1/2 -translate-x-1/2 z-[1000] px-6 py-3 rounded-full font-bold shadow-2xl transition-all duration-300 opacity-100 translate-y-0 ${type === 'success' ? 'bg-emerald-500 text-white' : 'bg-red-500 text-white'}`;
            
            setTimeout(() => {
                toast.classList.add('opacity-0');
                toast.classList.add('translate-y-[-20px]');
            }, 2000);
        }

        function updateStats() {
            document.getElementById('score').innerText = score;
            const acc = Math.round((score / (attempts * 100 || 1)) * 100);
            document.getElementById('accuracy').innerText = (acc > 100 ? 100 : acc) + "%";
        }

        function resetGame() {
            nextMission();
        }

        function toggleTheme() {
            const root = document.getElementById('html-root');
            root.classList.toggle('dark');
            const isDark = root.classList.contains('dark');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
        }

        window.onload = initMap;
    </script>
</body>
</html>
