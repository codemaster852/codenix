<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WalletNix - Manage Your Real-World Wealth</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap');
        
        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: #020617;
        }

        .glass-card {
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }

        .premium-gradient {
            background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 50%, #1e40af 100%);
        }

        .expense-gradient {
            background: linear-gradient(135deg, #ef4444 0%, #b91c1c 100%);
        }

        .card-shimmer {
            position: relative;
            overflow: hidden;
        }

        .card-shimmer::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(
                45deg,
                transparent,
                rgba(255, 255, 255, 0.03),
                transparent
            );
            transform: rotate(45deg);
            transition: 0.5s;
        }

        .card-shimmer:hover::after {
            left: 100%;
            top: 100%;
        }

        [onclick] { cursor: pointer; }

        .modal-overlay {
            background: rgba(2, 6, 23, 0.85);
            backdrop-filter: blur(8px);
        }

        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        .custom-scrollbar::-webkit-scrollbar {
            width: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: transparent;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #1e293b;
            border-radius: 10px;
        }
    </style>
</head>
<body class="text-slate-200 min-h-screen">

    <!-- Auth Guard Script -->
    <script type="module">
        import { createClient } from 'https://esm.sh/@supabase/supabase-js@2.39.7';
        
        const SUPABASE_URL = "https://rnlwrngfgvznndlekmrz.supabase.co";
        const SUPABASE_KEY = "sb_publishable_mtI0_ZBvU_n5oRuqV58QHg_qJt3Gfyt";
        const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

        async function checkAuth() {
            const { data: { session }, error } = await supabase.auth.getSession();
            
            if (error || !session) {
                // Not logged in: Redirect to auth.html
                window.location.replace('auth.html');
                return;
            }

            // User is signed in
            window.currentUser = session.user;
            updateUI(session.user);
        }

        function updateUI(user) {
            const emailEl = document.getElementById('user-email');
            if (emailEl) emailEl.textContent = user.email;
            
            const displayName = user.user_metadata?.full_name || 'Valued Member';
            const nameElements = document.querySelectorAll('.user-display-name');
            nameElements.forEach(el => el.textContent = displayName);
        }

        window.logout = async () => {
            const { error } = await supabase.auth.signOut();
            if (!error) {
                window.location.replace('auth.html');
            }
        };

        // Run check on load
        document.addEventListener('DOMContentLoaded', checkAuth);
    </script>

    <!-- Navbar -->
    <nav class="border-b border-slate-800 bg-slate-900/50 backdrop-blur-md sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 h-16 flex items-center justify-between">
            <div class="flex items-center gap-2">
                <div class="p-1.5 bg-blue-600 rounded-lg shadow-lg shadow-blue-500/40">
                    <i data-lucide="wallet" class="w-5 h-5 text-white"></i>
                </div>
                <span class="font-bold text-xl text-white tracking-tight">WalletNix</span>
            </div>
            
            <div class="flex items-center gap-4">
                <div class="hidden sm:flex flex-col items-end mr-2 text-right">
                    <span class="text-[10px] text-slate-500 uppercase font-bold tracking-wider">Active Wallet</span>
                    <span id="user-email" class="text-sm font-medium text-white italic">Verifying...</span>
                </div>
                <button onclick="logout()" class="p-2 text-slate-400 hover:text-white hover:bg-slate-800 rounded-xl transition-all border border-transparent hover:border-slate-700">
                    <i data-lucide="log-out" class="w-5 h-5"></i>
                </button>
            </div>
        </div>
    </nav>

    <main class="max-w-7xl mx-auto px-4 py-8">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <!-- Left Column: Balance & Management -->
            <div class="lg:col-span-2 space-y-8">
                
                <!-- Balance Card -->
                <div class="premium-gradient rounded-[2.5rem] p-8 md:p-10 text-white shadow-2xl relative overflow-hidden group">
                    <div class="relative z-10">
                        <div class="flex justify-between items-start mb-4">
                            <p class="text-blue-100 text-xs font-bold uppercase tracking-widest opacity-80">Total Real-World Balance</p>
                            <div class="bg-white/10 p-2 rounded-xl backdrop-blur-sm border border-white/10">
                                <i data-lucide="shield-check" class="w-4 h-4 text-blue-200"></i>
                            </div>
                        </div>
                        <h2 class="text-5xl md:text-6xl font-bold mb-10 tracking-tight">
                            <span class="text-blue-300 mr-2">$</span><span id="balance-amount">2,450.00</span>
                        </h2>
                        
                        <div class="flex flex-wrap gap-4">
                            <button onclick="toggleModal('balance-modal', true)" class="flex-1 min-w-[140px] bg-white text-blue-700 hover:bg-blue-50 py-4 rounded-2xl flex items-center justify-center gap-2 transition-all font-bold shadow-lg">
                                <i data-lucide="plus" class="w-5 h-5"></i> Income
                            </button>
                            <button onclick="toggleModal('expense-modal', true)" class="flex-1 min-w-[140px] bg-red-500 text-white hover:bg-red-400 py-4 rounded-2xl flex items-center justify-center gap-2 transition-all font-bold shadow-lg">
                                <i data-lucide="arrow-up-right" class="w-5 h-5"></i> Expense
                            </button>
                        </div>
                    </div>
                    
                    <div class="absolute top-0 right-0 w-64 h-64 bg-white/5 rounded-full -mr-20 -mt-20 blur-3xl group-hover:bg-white/10 transition-all duration-700"></div>
                </div>

                <!-- Stats Overview -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="glass-card p-6 rounded-3xl border border-slate-800">
                        <p class="text-[10px] text-slate-500 uppercase font-black tracking-widest mb-1">Monthly Spend</p>
                        <h4 id="stat-spend" class="text-2xl font-bold text-white">$412.50</h4>
                        <div class="mt-4 w-full bg-slate-800 h-1.5 rounded-full overflow-hidden">
                            <div class="bg-red-500 h-full w-[35%]"></div>
                        </div>
                    </div>
                    <div class="glass-card p-6 rounded-3xl border border-slate-800">
                        <p class="text-[10px] text-slate-500 uppercase font-black tracking-widest mb-1">Savings Rate</p>
                        <h4 class="text-2xl font-bold text-emerald-400">12.4%</h4>
                        <div class="mt-4 w-full bg-slate-800 h-1.5 rounded-full overflow-hidden">
                            <div class="bg-emerald-500 h-full w-[62%]"></div>
                        </div>
                    </div>
                </div>

                <!-- Virtual Card Area -->
                <div class="space-y-6">
                    <div class="flex items-center justify-between px-2">
                        <h3 class="text-xl font-bold text-white flex items-center gap-3">
                            <div class="w-8 h-8 rounded-full bg-blue-500/10 flex items-center justify-center">
                                <i data-lucide="credit-card" class="w-4 h-4 text-blue-500"></i>
                            </div>
                            Linked Digital Card
                        </h3>
                    </div>

                    <div id="card-container">
                        <div id="active-card" class="group relative w-full h-64 md:h-72 rounded-[2.5rem] bg-slate-900 border border-slate-800 shadow-2xl p-8 md:p-10 flex flex-col justify-between overflow-hidden card-shimmer">
                            <div class="flex justify-between items-start relative z-10">
                                <div class="space-y-1">
                                    <p class="text-[10px] text-slate-500 uppercase font-black tracking-[0.3em]">WalletNix Platinum</p>
                                    <span class="text-[10px] text-slate-400 font-medium italic">Synchronized Balance</span>
                                </div>
                                <div class="flex -space-x-3">
                                    <div class="w-8 h-8 rounded-full bg-red-500/80 backdrop-blur-sm"></div>
                                    <div class="w-8 h-8 rounded-full bg-amber-500/80 backdrop-blur-sm"></div>
                                </div>
                            </div>

                            <div class="space-y-8 relative z-10">
                                <p id="display-number" class="text-2xl md:text-3xl font-mono tracking-[0.2em] text-white font-medium">4412 8892 0012 4492</p>
                                <div class="flex justify-between items-end">
                                    <div class="flex gap-10">
                                        <div class="space-y-1">
                                            <p class="text-[9px] text-slate-500 uppercase font-bold tracking-widest">Global Manager</p>
                                            <p class="user-display-name text-sm font-bold uppercase tracking-tight text-slate-200">User</p>
                                        </div>
                                        <div class="space-y-1">
                                            <p class="text-[9px] text-slate-500 uppercase font-bold tracking-widest">Valid Thru</p>
                                            <p class="text-sm font-bold text-slate-200">12/28</p>
                                        </div>
                                    </div>
                                    <div class="space-y-1 text-right">
                                        <p class="text-[9px] text-slate-500 uppercase font-bold tracking-widest">CVV</p>
                                        <div class="flex items-center justify-end gap-2">
                                            <p id="display-cvv" class="text-sm font-bold font-mono text-slate-200">***</p>
                                            <button onclick="toggleCVV()" class="text-slate-500 hover:text-blue-400"><i data-lucide="eye" class="w-4 h-4"></i></button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Column -->
            <div class="space-y-6">
                <div class="glass-card rounded-[2rem] p-8 shadow-xl">
                    <h3 class="font-bold text-white mb-8">Real-Time Ledger</h3>
                    <div id="transaction-list" class="space-y-7 h-[450px] overflow-y-auto pr-2 custom-scrollbar">
                        <!-- Initial items -->
                        <div class="flex items-center justify-between">
                            <div class="flex items-center gap-4">
                                <div class="w-11 h-11 rounded-2xl bg-slate-800 flex items-center justify-center"><i data-lucide="shopping-cart" class="w-5 h-5 text-slate-400"></i></div>
                                <div><p class="text-sm font-bold text-white">Groceries</p><p class="text-[10px] text-slate-500 uppercase">Essentials • Today</p></div>
                            </div>
                            <p class="text-sm font-black text-white">-$42.50</p>
                        </div>
                        <div class="flex items-center justify-between">
                            <div class="flex items-center gap-4">
                                <div class="w-11 h-11 rounded-2xl bg-emerald-500/10 flex items-center justify-center"><i data-lucide="trending-up" class="w-5 h-5 text-emerald-400"></i></div>
                                <div><p class="text-sm font-bold text-white">Freelance Payment</p><p class="text-[10px] text-slate-500 uppercase">Work • Yesterday</p></div>
                            </div>
                            <p class="text-sm font-black text-emerald-400">+$850.00</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Modal: Add Balance (Income) -->
    <div id="balance-modal" class="fixed inset-0 z-[100] hidden flex items-center justify-center p-4 modal-overlay">
        <div class="bg-slate-900 border border-slate-800 w-full max-w-md rounded-[2.5rem] p-8 shadow-2xl transform transition-all">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold text-white">Add Income</h3>
                <button onclick="toggleModal('balance-modal', false)" class="text-slate-500 hover:text-white transition-colors">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
            </div>
            <div class="space-y-4 mb-8">
                <div>
                    <label class="text-[10px] font-bold text-slate-500 uppercase mb-2 block">Source Name</label>
                    <input type="text" id="income-name" placeholder="Salary, Gift, etc." class="w-full bg-slate-950 border border-slate-800 rounded-xl py-3 px-4 text-white outline-none focus:ring-1 focus:ring-blue-600">
                </div>
                <div>
                    <label class="text-[10px] font-bold text-slate-500 uppercase mb-2 block">Amount</label>
                    <div class="relative">
                        <span class="absolute left-4 top-1/2 -translate-y-1/2 text-slate-500 font-bold">$</span>
                        <input type="number" id="income-amount" placeholder="0.00" class="w-full bg-slate-950 border border-slate-800 rounded-xl py-4 pl-8 pr-4 text-white font-bold text-2xl focus:ring-2 focus:ring-blue-600 outline-none">
                    </div>
                </div>
            </div>
            <button onclick="recordTransaction('income')" class="w-full bg-blue-600 hover:bg-blue-500 text-white font-bold py-4 rounded-2xl transition-all shadow-lg shadow-blue-900/40">Confirm Deposit</button>
        </div>
    </div>

    <!-- Modal: Record Spend (Expense) -->
    <div id="expense-modal" class="fixed inset-0 z-[100] hidden flex items-center justify-center p-4 modal-overlay">
        <div class="bg-slate-900 border border-slate-800 w-full max-w-md rounded-[2.5rem] p-8 shadow-2xl transform transition-all">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold text-white">Record Spend</h3>
                <button onclick="toggleModal('expense-modal', false)" class="text-slate-500 hover:text-white transition-colors">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
            </div>
            <div class="space-y-4 mb-8">
                <div>
                    <label class="text-[10px] font-bold text-slate-500 uppercase mb-2 block">What did you buy?</label>
                    <input type="text" id="expense-name" placeholder="Lunch, Gas, Subscription..." class="w-full bg-slate-950 border border-slate-800 rounded-xl py-3 px-4 text-white outline-none focus:ring-1 focus:ring-red-600">
                </div>
                <div>
                    <label class="text-[10px] font-bold text-slate-500 uppercase mb-2 block">Amount Spent</label>
                    <div class="relative">
                        <span class="absolute left-4 top-1/2 -translate-y-1/2 text-slate-500 font-bold">$</span>
                        <input type="number" id="expense-amount" placeholder="0.00" class="w-full bg-slate-950 border border-slate-800 rounded-xl py-4 pl-8 pr-4 text-white font-bold text-2xl focus:ring-2 focus:ring-red-600 outline-none">
                    </div>
                </div>
            </div>
            <button onclick="recordTransaction('expense')" class="w-full bg-red-600 hover:bg-red-500 text-white font-bold py-4 rounded-2xl transition-all shadow-lg shadow-red-900/40">Deduct Balance</button>
        </div>
    </div>

    <footer class="max-w-7xl mx-auto px-4 py-12 text-center">
        <p class="text-[10px] text-slate-600 font-bold uppercase tracking-[0.4em]">WALLETNIX FINANCIAL COMMAND CENTER</p>
    </footer>

    <script>
        let currentBalance = 2450.00;
        let monthlySpend = 412.50;

        function updateDisplay() {
            const balEl = document.getElementById('balance-amount');
            const spendEl = document.getElementById('stat-spend');
            
            if (balEl) balEl.innerText = currentBalance.toLocaleString(undefined, { minimumFractionDigits: 2 });
            if (spendEl) spendEl.innerText = '$' + monthlySpend.toLocaleString(undefined, { minimumFractionDigits: 2 });
        }

        function toggleModal(id, show) {
            const modal = document.getElementById(id);
            if (!modal) return;
            if (show) {
                modal.classList.remove('hidden');
                const numInput = modal.querySelector('input[type="number"]');
                if (numInput) numInput.focus();
            } else {
                modal.classList.add('hidden');
            }
        }

        function recordTransaction(type) {
            const prefix = type === 'income' ? 'income' : 'expense';
            const nameInput = document.getElementById(`${prefix}-name`);
            const amountInput = document.getElementById(`${prefix}-amount`);
            
            const name = nameInput.value || (type === 'income' ? 'Cash Deposit' : 'General Purchase');
            const amount = parseFloat(amountInput.value);

            if (isNaN(amount) || amount <= 0) return;

            if (type === 'income') {
                currentBalance += amount;
            } else {
                currentBalance -= amount;
                monthlySpend += amount;
            }

            // Update UI
            updateDisplay();
            addToList(name, amount, type);

            // Reset and close
            nameInput.value = '';
            amountInput.value = '';
            toggleModal(`${prefix}-modal`, false);
        }

        function addToList(name, amount, type) {
            const list = document.getElementById('transaction-list');
            if (!list) return;

            const div = document.createElement('div');
            const isIncome = type === 'income';
            
            div.className = "flex items-center justify-between opacity-0 translate-y-2 transition-all duration-500";
            div.innerHTML = `
                <div class="flex items-center gap-4">
                    <div class="w-11 h-11 rounded-2xl ${isIncome ? 'bg-emerald-500/10' : 'bg-slate-800'} flex items-center justify-center">
                        <i data-lucide="${isIncome ? 'trending-up' : 'shopping-bag'}" class="w-5 h-5 ${isIncome ? 'text-emerald-400' : 'text-slate-400'}"></i>
                    </div>
                    <div>
                        <p class="text-sm font-bold text-white">${name}</p>
                        <p class="text-[10px] text-slate-500 uppercase">Self • Just Now</p>
                    </div>
                </div>
                <p class="text-sm font-black ${isIncome ? 'text-emerald-400' : 'text-white'}">
                    ${isIncome ? '+' : '-'}$${amount.toLocaleString(undefined, { minimumFractionDigits: 2 })}
                </p>
            `;
            
            list.prepend(div);
            setTimeout(() => {
                div.classList.remove('opacity-0', 'translate-y-2');
            }, 10);
            
            lucide.createIcons();
        }

        let cvvVisible = false;
        function toggleCVV() {
            cvvVisible = !cvvVisible;
            const cvvEl = document.getElementById('display-cvv');
            if (cvvEl) cvvEl.innerText = cvvVisible ? '882' : '***';
        }

        // Init UI components
        window.addEventListener('load', () => {
            lucide.createIcons();
            updateDisplay();
        });
    </script>
</body>
</html>
